# PHP笔记

PHP是一种通用开源脚本语言，最初的全称是Personal Home Page，之后更名为PHP:Hypertext Preprocessor。从名称也可以看出来，它最初只是用来创建个人主页的程序，但是在不断发展和完善的过程中，已经成为一种通用的超文本预处理器。

PHP语法简单，便于学习，所以在中小型Web应用的快速开发中有其独特的优势。



## 环境安装

PHP是一种脚本语言，所以它只能通过解释器来运行，同时PHP主要用于Web应用开发，所以需要安装Web服务器，一般用Apache服务器。另外，数据库通常也是不可缺少的，一般都使用mysql。

版本选择上通常不会选择最新的版本，所以php一般用6.x或7.x即可，Apache用2.4即可，mysql用5.7即可。



## 基本语法

php同样是一种面向对象的语言，所以语法上和和C语言有很多相似之处，另外由于它是一种脚本语言，所以也采用了一些Shell脚本的语言



### php源文件

php源文件中的内容可分为普通文本和php脚本块，HTML、JS代码都属于普通文本

php源文件以`.php`为扩展名

运行过程中，首先由浏览器发起资源请求，Apache收到请求后，若请求的资源后缀为php，则调用php解释器进行解析。

php解释器在解析时，源文件中的非php脚本块原样输出，只执行php脚本块中的代码，在php代码块中可以使用`echo print`命令把执行的结果插入到文档流中，然后把解析之后的结果返回给Apache，最后由Apache把结果返回给浏览器。



### 变量

PHP和JavaScript类似，都是弱类型和动态类型的语言。PHP中变量不需要声明，可以直接赋值和使用。

变量名由`$`开头，后跟标识符，标识符是由字母或下划线开头并后跟数字、字母、下划线的符号组合。

```php
<?php
    $str = "Hello";  
	echo $str;
?>
```

**变量的作用域** ： 变量按作用范围不同，可以划分为局部变量和全局变量，按照保存区域可以分为普通栈变量和静态变量。

在函数内部声明的变量是**局部变量**，只能在声明它的函数内部使用。

在所有函数外声明的变量是**全局变量**，可以全局作用域(也就是当前源文件中)内使用。在函数内使用全局变量时需要用global关键字声明

```php
<?php
$x = 5; // 全局变量
function test(){
    global $x; // 声明全局变量
    $y = 10; // 局部变量
    $x = $x+$y; // 使用全局变量
    echo($x);
}
test();
echo($x);
?>
```

另外，使用全局变量时，必须确保变量已存在，否则返回空。实际上，所有的全局变量都存储在一个名为`$GLOBALS`数组中，可以通过`$GLOBALS['v_name']`或访问。

静态变量在函数运行结束后并不会被释放，所以下次调用函数时可以继续使用它之前的值。



### 数据类型

1. 字符串String，用单引号或双引号表示，其中单引号中的内容都会作为字符串处理，**双引号中的变量会替换为值**， 字符串的拼接使用'.'，也叫作并置运算符
2. 整型  Integer，表示整数，十六进制数字以0x开头，八进制数据以0开头
3. 浮点数Float  
4. 布尔型Boolean 
5. 数组  Array 
6. 对象  Object 
7. 空 NULL ,只有一个值null，可以用null清空变量的值

关于各种类型的零值比较是一个需要注意的问题

```php
0 == false;
0 == null;
false == null;
'0' == false;
'' == false;
'' == null;

注意：'0' != null  
```



### 常量

php中的常量就是C语言中的宏，在脚本执行之前会先替换脚本中的常量

定义常量：`bool define($name, $value[,bCaseInsensitive]);`

name 是常量名，value是常量值，bCaseInsensitive表示是否大小写敏感，默认true



### 数组

```php
$cars = array('Volvo','BMW','Toyota');
```



### 运算符与表达式

php中的运算符与js中基本一致，分为算术运算符、赋值运算符、比较运算符、逻辑运算符、三目运算符。不过也有一些特殊的点：

```php
// 并置运算符，也就是字符串拼接
"He"."llo" == "hello"  
// 比较运算符
== 值相等
=== 值和类型都相等，即绝对相等，
!= 值不等
!== 值和类型至少有一个不相等
// 逻辑运算符
&& || !         也可以用and or not xor
// 数组运算符
+     数组的合集
== === != !==   比较数组是否相等

    
```



### 数组

php中的数组包括C语言中的数组、map、链表等多种数据结构，所以使用上也可以分为三种：

- 数值数组，用数值索引访问
- 关联数组，通过键来访问
- 多维数组

创建： `array();`

增：普通数组直接使用下标来添加新元素即可，关联数组则通过新的键来添加元素。

删：`unset(age['Peter'])`

```php
$cars = array('Volvo','BMW','Toyota'); // 创建普通数组
$ages = array('Peter'=>"35","Ben"=>"37","Joe"=>"43"); // 关联数组创建

// 关联数组遍历
foreach($ages as $x=>$x_value)
{
    echo "Key=" . $x . ", Value=" . $x_value;
    echo "<br>";
}
```

相关函数：

- 数组长度 ：`count($arr)`



### 函数

php中提供了超过1000个内置函数，大大提高了开发速度。我们也可以开发自己的函数

```php
function fName(args1,args2..){
    // do something
    
    return value;
}
```




## 流程控制

php的流程控制语法和C语言完全一样，这里只简单介绍一点独特的语法

```php
//foreach 用于遍历数组
foreach($array as $value){ // $array是数组， $value是数组中的值
    // do something
}
    
```



## 内置全局变量

php提供了一些内置的全局变量来增强功能，这些变量全部大写，并且通常以_开头，需要说明的是每个php代码片段中都会有新的内置变量，无法用来传递数据

列表如下：

- $GLOBALS  保存全局变量的数组，其他变量都是这个变量的属性
- $_SERVER  包含了头信息、路径以及脚本位置等信息的数组，内容由Web服务器填充
- $_REQUEST  用于收集HTML表单提交的数据
- $_POST  用于收集Post表单数据
- $_GET    用于收集Get表单数据
- $_FILES  
- $_ENV
- $_COOKIE
- $_SESSION



## 魔术常量

magic num，在解释器解析的过程中会为这些常量赋予正确的值，虽然对开发人员来说这些变量是固定的，但实际上是在解释时动态生成的。

- `__LINE__`  行号
- `__FILE__` 完整文件文件名
- `__DIR__` 文件目录
- `__FUNCTION__` 函数名
- `__CLASS__` 成员方法内返回类名称
- `__METHOD__ ` 方法名
- `__NAMESPACE__` 命名空间名称



## 命名空间

命名空间主要用于解决命名冲突的问题，另外也提供了别名功能，从而提高源码的可读性

命名空间使用namespace声明,比如

```php
namespace MyProject; // 后面的代码都放在MyProject这个命名空间中，直到下一个namespace或者include为止
namespace NS2{ // 也可以用这种方式定义命名空间
	// define class and function etc.
}
```

如果要在全局返回内使用某个命名空间中的方法，需要按照下面的方式

```php
namespace MyPro{
	const status = 1;
	function connect(){}
}

namespace{ // 全局代码，通过匿名命名空间访问其他命名空间
	$result = MyPro\connect();
}
```

在命名空间外只能有定义源文件编码方式的declare语句
`declare(encoding='UTF-8');`

命名空间中可以使用\来指定层次化的命名空间

使用命名空间中的类或方法：
1. 当前命名空间或全局命名空间中的类和方法可以直接使用
2. 基于当前命名空间来查找子命名空间中的类和方法，比如当前命名空间为CurNS,则$ret = new subNS\foo()就表示CurNS\subNS\foo()
3. 使用以\开头的完全限定名称，$ret = \CurNS\subNS\foo();

别名/导入：
	可以为类名称指定别名，也可以为命名空间名称使用别名
	`use MyPro\subNS\ClassName as MyClass`
	`use MyPro\SubNS\NS;  使用最后一级作为别名，等价于use MyPro\SubNS\NS as NS;`

全局命名空间：
	未使用namespace指定命名空间的代码都在全局命名空间中，前缀为\



## 面向对象

面向对象主要包括以下特性

- **类** − 定义了一件事物的抽象特点。类的定义包含了数据的形式以及对数据的操作。
- **对象** − 是类的实例。
- **成员变量** − 定义在类内部的变量。该变量的值对外是不可见的，但是可以通过成员函数访问，在类被实例化为对象后，该变量即可称为对象的属性。
- **成员函数** − 定义在类的内部，可用于访问对象的数据。
- **继承** − 继承性是子类自动共享父类数据结构和方法的机制，这是类之间的一种关系。在定义和实现一个类的时候，可以在一个已经存在的类的基础之上来进行，把这个已经存在的类所定义的内容作为自己的内容，并加入若干新的内容。
- **父类** − 一个类被其他类继承，可将该类称为父类，或基类，或超类。
- **子类** − 一个类继承其他类称为子类，也可称为派生类。
- **多态** − 多态性是指相同的函数或方法可作用于多种类型的对象上并获得不同的结果。不同的对象，收到同一消息可以产生不同的结果，这种现象称为多态性。
- **重载** − 简单说，就是函数或者方法有同样的名称，但是参数列表不相同的情形，这样的同名不同参数的函数或者方法之间，互相称之为重载函数或者方法。
- **抽象性** − 抽象性是指将具有一致的数据结构（属性）和行为（操作）的对象抽象成类。一个类就是这样一种抽象，它反映了与应用有关的重要性质，而忽略其他一些无关内容。任何类的划分都是主观的，但必须与具体的应用有关。
- **封装** − 封装是指将现实世界中存在的某个客体的属性与行为绑定在一起，并放置在一个逻辑单元内。
- **构造函数** − 主要用来在创建对象时初始化对象， 即为对象成员变量赋初始值，总与new运算符一起使用在创建对象的语句中。
- **析构函数** − 析构函数(destructor) 与构造函数相反，当对象结束其生命周期时（例如对象所在的函数已调用完毕），系统自动执行析构函数。析构函数往往用来做"清理善后" 的工作（例如在建立对象时用new开辟了一片内存空间，应在退出前在析构函数中用delete释放）。

### 类定义

类使用class关键字定义，成员变量使用var关键字声明，成员函数的定义方法和普通方法一样，在类中可以使用`$this`表示当前对象，`__construct`表示构造函数

```php
class Car{
    var $color;
    function __construct($color='green'){
        $this->color = $color;
    }
    function whatColor(){
        return $this->color;
    }
}
```

### 创建对象

使用new关键字创建对象,然后用`->`访问成员属性和方法。

```php
$car = new Car();
$car->whatColor();
```











## 其他

注释：

​		当行注释`//comment  `   多行注释 `/*comment*/`

输出到文档流： 

​		echo 和 print ，他们既可以当做命令，也可以当做函数，区别是echo 的参数可以有多个，print只能有一个参数

​		另外，php中采用shell中的EOF语法来表示跨行的字符串，也就是字符串内容原样输出，包括转义字符。它的语法如下：

```php
echo <<<EOF
	some string you want to output
	the second line
EOF; // 结束的标识必须顶格独占一行
// EOF可以是任意的字符，只要开始和结束字符一致即可（注意，字符串中间不能出现此标记）
```

输出数据类型： 

​		`var_dump($var)`

字符串操作

​		'a'.'b' ==> 'ab' 拼接

​		strlen()  字符串长度 strpos() 查找子串

文件包含

​		类似于c语言中的include，php中使用 `include 'file2.php'`把其他脚本包含到当前脚本中

动态类型特性：

```php
<?php
class ClassName
{
    function __construct()
    {
        echo __METHOD__,"\n";
    }
}
function funcName()
{
    echo __FUNCTION__,"\n";
}
const constname = "global";

$a = 'ClassName';
$obj = new $a; // new后面是一个类名即可
$b = 'funcName';
$b(); // 括号前是一个方法名即可
echo constant('constname'), "\n"; // prints global
?>
```

